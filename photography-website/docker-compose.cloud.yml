services:
  app:
    build: .
    restart: unless-stopped
    ports:
      - "3000:3000"
    volumes:
      - next_cache:/app/.next
    command: >
      /bin/sh -c "
        echo 'Building application (SSG)...' &&
        bun run build &&
        echo 'Starting server...' &&
        bun start
      "
    environment:
      # Database (Defaults to Cloud/Neon if not set to 'local')
      - DATABASE_PROVIDER=cloud
      
      # Environment variables should be passed via a .env file or the host environment
      # Required vars:
      # - DATABASE_URL
      # - BETTER_AUTH_SECRET
      # - BETTER_AUTH_URL
      # - NEXT_PUBLIC_APP_URL
      # - S3_ACCESS_KEY_ID
      # - S3_SECRET_ACCESS_KEY
      # - S3_BUCKET_NAME
      # - S3_REGION (Optional)
      # - S3_ENDPOINT (Optional, for Cloudflare R2 etc.)
      # - S3_PUBLIC_URL
      # - NEXT_PUBLIC_S3_PUBLIC_URL
    env_file:
      - .env

volumes:
  next_cache:
