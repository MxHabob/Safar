# إعداد Stripe في الواجهة الأمامية

تم إكمال إعداد Stripe في الواجهة الأمامية باستخدام طريقة عنصر الإدخال الواحد (Payment Element).

## الخطوات المطلوبة

### 1. تثبيت الحزم

قم بتثبيت حزم Stripe المطلوبة:

```bash
cd web
npm install @stripe/stripe-js @stripe/react-stripe-js
```

### 2. إعداد متغيرات البيئة

أضف مفتاح Stripe القابل للنشر (Publishable Key) إلى ملف `.env.local` في مجلد `web`:

```env
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_your_publishable_key_here
```

**ملاحظة:** 
- استخدم `pk_test_` للتطوير والاختبار
- استخدم `pk_live_` للإنتاج
- يمكنك الحصول على المفتاح من [لوحة تحكم Stripe](https://dashboard.stripe.com/apikeys)

### 3. الملفات المضافة/المعدلة

#### ملفات جديدة:
- `web/src/lib/providers/stripe-provider.tsx` - مكون Provider لتوفير Stripe Elements

#### ملفات معدلة:
- `web/src/features/payments/components/payment-form.tsx` - تم تحديثه لاستخدام Stripe Payment Element

## الميزات المضافة

✅ **Stripe Payment Element** - عنصر إدخال واحد يدعم:
- بطاقات الائتمان والخصم
- Apple Pay
- Google Pay
- طرق دفع محلية أخرى حسب المنطقة

✅ **تأكيد الدفع** - يتم تأكيد الدفع تلقائياً مع Stripe قبل المعالجة

✅ **معالجة الأخطاء** - معالجة شاملة للأخطاء مع رسائل واضحة للمستخدم

✅ **3D Secure** - دعم التحقق الإضافي (3D Secure) تلقائياً

## كيفية الاستخدام

بعد إكمال الإعداد، سيعمل نموذج الدفع تلقائياً:

1. عند اختيار "Credit/Debit Card (Stripe)" سيظهر عنصر Stripe Payment Element
2. يقوم المستخدم بإدخال بيانات البطاقة
3. عند الضغط على "Pay"، يتم تأكيد الدفع مع Stripe
4. إذا تطلب الأمر تحقق إضافي (3D Secure)، سيتم التوجيه تلقائياً
5. بعد نجاح الدفع، يتم معالجة الدفع في النظام

## الاختبار

لاختبار الدفع، استخدم بطاقات الاختبار من Stripe:

- **بطاقة ناجحة:** `4242 4242 4242 4242`
- **بطاقة تتطلب 3D Secure:** `4000 0025 0000 3155`
- **بطاقة مرفوضة:** `4000 0000 0000 0002`

استخدم أي تاريخ انتهاء مستقبلي و CVV أي 3 أرقام.

## ملاحظات إضافية

- يتم تحميل Stripe.js تلقائياً عند الحاجة
- التصميم متوافق مع نظام التصميم الحالي (border-radius: 18px)
- يدعم الوضع الداكن تلقائياً
- آمن تماماً - لا يتم إرسال بيانات البطاقة إلى الخادم

