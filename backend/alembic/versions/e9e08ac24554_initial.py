"""initial

Revision ID: e9e08ac24554
Revises: 
Create Date: 2025-12-01 14:39:51.593969

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = 'e9e08ac24554'
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('agencies',
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('slug', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('logo_url', sa.String(length=500), nullable=True),
    sa.Column('email', sa.String(length=255), nullable=False),
    sa.Column('phone_number', sa.String(length=20), nullable=True),
    sa.Column('website', sa.String(length=500), nullable=True),
    sa.Column('address', sa.Text(), nullable=True),
    sa.Column('country', sa.String(length=100), nullable=True),
    sa.Column('city', sa.String(length=100), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('settings', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_agencies_email'), 'agencies', ['email'], unique=False)
    op.create_index(op.f('ix_agencies_id'), 'agencies', ['id'], unique=False)
    op.create_index(op.f('ix_agencies_is_active'), 'agencies', ['is_active'], unique=False)
    op.create_index(op.f('ix_agencies_name'), 'agencies', ['name'], unique=False)
    op.create_index(op.f('ix_agencies_slug'), 'agencies', ['slug'], unique=True)
    op.create_table('amenities',
    sa.Column('key', sa.String(length=100), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('name_ar', sa.String(length=100), nullable=True),
    sa.Column('name_en', sa.String(length=100), nullable=True),
    sa.Column('label', sa.String(length=100), nullable=True),
    sa.Column('icon', sa.String(length=100), nullable=True),
    sa.Column('category', sa.String(length=50), nullable=True),
    sa.Column('is_featured', sa.Boolean(), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_amenities_category'), 'amenities', ['category'], unique=False)
    op.create_index(op.f('ix_amenities_id'), 'amenities', ['id'], unique=False)
    op.create_index(op.f('ix_amenities_key'), 'amenities', ['key'], unique=True)
    op.create_table('bookings',
    sa.Column('booking_number', sa.String(length=50), nullable=False),
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('guest_id', sa.String(length=40), nullable=False),
    sa.Column('check_in', sa.DateTime(timezone=True), nullable=False),
    sa.Column('check_out', sa.DateTime(timezone=True), nullable=False),
    sa.Column('check_in_date', sa.Date(), nullable=True),
    sa.Column('check_out_date', sa.Date(), nullable=True),
    sa.Column('nights', sa.Integer(), nullable=False),
    sa.Column('adults', sa.Integer(), nullable=False),
    sa.Column('children', sa.Integer(), nullable=False),
    sa.Column('infants', sa.Integer(), nullable=False),
    sa.Column('guests', sa.Integer(), nullable=False),
    sa.Column('total_guests', sa.Integer(), nullable=True),
    sa.Column('base_price', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('cleaning_fee', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('service_fee', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('security_deposit', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('discount_amount', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('coupon_code', sa.String(length=50), nullable=True),
    sa.Column('total_amount', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('total_price', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('payout_amount', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('currency', sa.String(length=10), nullable=False),
    sa.Column('fees', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('payment_status', sa.String(length=50), nullable=False),
    sa.Column('payment_id', sa.String(length=40), nullable=True),
    sa.Column('payment_method', sa.Enum('CREDIT_CARD', 'DEBIT_CARD', 'PAYPAL', 'STRIPE', 'BANK_TRANSFER', 'CRYPTO', name='paymentmethodtype'), nullable=True),
    sa.Column('payment_intent_id', sa.String(length=255), nullable=True),
    sa.Column('paid_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('special_requests', sa.Text(), nullable=True),
    sa.Column('guest_message', sa.Text(), nullable=True),
    sa.Column('cancelled_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('cancellation_reason', sa.Text(), nullable=True),
    sa.Column('refund_amount', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    # NOTE: Foreign keys to users, listings, and payments are added in a later migration
    # to avoid "relation does not exist" errors during initial schema creation.
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_booking_dates', 'bookings', ['check_in', 'check_out', 'status'], unique=False)
    op.create_index('idx_booking_guest_status', 'bookings', ['guest_id', 'status'], unique=False)
    op.create_index('idx_booking_listing_dates', 'bookings', ['listing_id', 'check_in', 'check_out'], unique=False)
    op.create_index('idx_booking_payment_status', 'bookings', ['payment_status', 'status'], unique=False)
    op.create_index(op.f('ix_bookings_booking_number'), 'bookings', ['booking_number'], unique=True)
    op.create_index(op.f('ix_bookings_check_in'), 'bookings', ['check_in'], unique=False)
    op.create_index(op.f('ix_bookings_check_in_date'), 'bookings', ['check_in_date'], unique=False)
    op.create_index(op.f('ix_bookings_check_out'), 'bookings', ['check_out'], unique=False)
    op.create_index(op.f('ix_bookings_check_out_date'), 'bookings', ['check_out_date'], unique=False)
    op.create_index(op.f('ix_bookings_coupon_code'), 'bookings', ['coupon_code'], unique=False)
    op.create_index(op.f('ix_bookings_guest_id'), 'bookings', ['guest_id'], unique=False)
    op.create_index(op.f('ix_bookings_id'), 'bookings', ['id'], unique=False)
    op.create_index(op.f('ix_bookings_listing_id'), 'bookings', ['listing_id'], unique=False)
    op.create_index(op.f('ix_bookings_payment_id'), 'bookings', ['payment_id'], unique=False)
    op.create_index(op.f('ix_bookings_payment_intent_id'), 'bookings', ['payment_intent_id'], unique=False)
    op.create_index(op.f('ix_bookings_payment_status'), 'bookings', ['payment_status'], unique=False)
    op.create_index(op.f('ix_bookings_status'), 'bookings', ['status'], unique=False)
    op.create_table('coupons',
    sa.Column('code', sa.String(length=50), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('discount_type', sa.Enum('PERCENTAGE', 'FIXED_AMOUNT', 'FREE_NIGHTS', name='discounttype'), nullable=False),
    sa.Column('discount_value', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('max_discount_amount', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('min_purchase_amount', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('start_date', sa.Date(), nullable=False),
    sa.Column('end_date', sa.Date(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('max_uses', sa.Integer(), nullable=True),
    sa.Column('max_uses_per_user', sa.Integer(), nullable=False),
    sa.Column('current_uses', sa.Integer(), nullable=False),
    sa.Column('applicable_to_properties', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('applicable_to_property_types', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('applicable_to_users', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_coupon_code_active', 'coupons', ['code', 'is_active'], unique=False)
    op.create_index('idx_coupon_dates', 'coupons', ['start_date', 'end_date', 'is_active'], unique=False)
    op.create_index(op.f('ix_coupons_code'), 'coupons', ['code'], unique=True)
    op.create_index(op.f('ix_coupons_end_date'), 'coupons', ['end_date'], unique=False)
    op.create_index(op.f('ix_coupons_id'), 'coupons', ['id'], unique=False)
    op.create_index(op.f('ix_coupons_is_active'), 'coupons', ['is_active'], unique=False)
    op.create_index(op.f('ix_coupons_start_date'), 'coupons', ['start_date'], unique=False)
    op.create_table('loyalty_programs',
    sa.Column('code', sa.String(length=50), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('tiers', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_loyalty_program_code', 'loyalty_programs', ['code'], unique=False)
    op.create_index(op.f('ix_loyalty_programs_code'), 'loyalty_programs', ['code'], unique=True)
    op.create_index(op.f('ix_loyalty_programs_id'), 'loyalty_programs', ['id'], unique=False)
    op.create_table('payments',
    sa.Column('booking_id', sa.String(length=40), nullable=True),
    sa.Column('method_id', sa.String(length=40), nullable=True),
    sa.Column('processor', sa.String(length=50), nullable=False),
    sa.Column('processor_ref', sa.String(length=255), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('amount', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.String(length=10), nullable=False),
    sa.Column('captured_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('payment_method', sa.Enum('CREDIT_CARD', 'DEBIT_CARD', 'PAYPAL', 'STRIPE', 'BANK_TRANSFER', 'CRYPTO', name='paymentmethodtype'), nullable=True),
    sa.Column('stripe_payment_intent_id', sa.String(length=255), nullable=True),
    sa.Column('paypal_order_id', sa.String(length=255), nullable=True),
    sa.Column('transaction_id', sa.String(length=255), nullable=True),
    sa.Column('processed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['booking_id'], ['bookings.id'], ondelete='CASCADE'),
    # NOTE: Foreign key to payment_methods is added in a later migration
    # to avoid referencing a table that has not yet been created.
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('stripe_payment_intent_id', name='uq_payment_stripe_intent')
    )
    op.create_index('idx_payment_booking_status', 'payments', ['booking_id', 'status'], unique=False)
    op.create_index('idx_payment_processor_ref', 'payments', ['processor', 'processor_ref'], unique=False)
    op.create_index(op.f('ix_payments_booking_id'), 'payments', ['booking_id'], unique=False)
    op.create_index(op.f('ix_payments_id'), 'payments', ['id'], unique=False)
    op.create_index(op.f('ix_payments_method_id'), 'payments', ['method_id'], unique=False)
    op.create_index(op.f('ix_payments_paypal_order_id'), 'payments', ['paypal_order_id'], unique=False)
    op.create_index(op.f('ix_payments_processor_ref'), 'payments', ['processor_ref'], unique=False)
    op.create_index(op.f('ix_payments_status'), 'payments', ['status'], unique=False)
    op.create_index(op.f('ix_payments_stripe_payment_intent_id'), 'payments', ['stripe_payment_intent_id'], unique=False)
    op.create_index(op.f('ix_payments_transaction_id'), 'payments', ['transaction_id'], unique=False)
    op.create_table('payout_batches',
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('currency', sa.String(length=10), nullable=False),
    sa.Column('total_amount', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('scheduled_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('processed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_payout_batch_status_scheduled', 'payout_batches', ['status', 'scheduled_at'], unique=False)
    op.create_index(op.f('ix_payout_batches_id'), 'payout_batches', ['id'], unique=False)
    op.create_index(op.f('ix_payout_batches_scheduled_at'), 'payout_batches', ['scheduled_at'], unique=False)
    op.create_index(op.f('ix_payout_batches_status'), 'payout_batches', ['status'], unique=False)
    op.create_table('webhook_events',
    sa.Column('event_id', sa.String(length=255), nullable=False),
    sa.Column('event_type', sa.String(length=100), nullable=False),
    sa.Column('source', sa.String(length=50), nullable=False),
    sa.Column('payload', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('processed_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('event_id', name='uq_webhook_event_id')
    )
    op.create_index('idx_webhook_event_type_status', 'webhook_events', ['event_type', 'status', 'processed_at'], unique=False)
    op.create_index('idx_webhook_source_event_id', 'webhook_events', ['source', 'event_id'], unique=False)
    op.create_index(op.f('ix_webhook_events_event_id'), 'webhook_events', ['event_id'], unique=True)
    op.create_index(op.f('ix_webhook_events_event_type'), 'webhook_events', ['event_type'], unique=False)
    op.create_index(op.f('ix_webhook_events_id'), 'webhook_events', ['id'], unique=False)
    op.create_index(op.f('ix_webhook_events_source'), 'webhook_events', ['source'], unique=False)
    op.create_index(op.f('ix_webhook_events_status'), 'webhook_events', ['status'], unique=False)
    op.create_table('booking_timeline_events',
    sa.Column('booking_id', sa.String(length=40), nullable=False),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('payload', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['booking_id'], ['bookings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_timeline_booking_status', 'booking_timeline_events', ['booking_id', 'status', 'created_at'], unique=False)
    op.create_index(op.f('ix_booking_timeline_events_booking_id'), 'booking_timeline_events', ['booking_id'], unique=False)
    op.create_index(op.f('ix_booking_timeline_events_id'), 'booking_timeline_events', ['id'], unique=False)
    op.create_table('disputes',
    sa.Column('booking_id', sa.String(length=40), nullable=False),
    sa.Column('reason', sa.Text(), nullable=False),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('resolution', sa.Text(), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['booking_id'], ['bookings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_dispute_booking_status', 'disputes', ['booking_id', 'status'], unique=False)
    op.create_index(op.f('ix_disputes_booking_id'), 'disputes', ['booking_id'], unique=False)
    op.create_index(op.f('ix_disputes_id'), 'disputes', ['id'], unique=False)
    op.create_index(op.f('ix_disputes_status'), 'disputes', ['status'], unique=False)
    op.create_table('users',
    sa.Column('email', sa.String(length=255), nullable=False),
    sa.Column('phone_number', sa.String(length=20), nullable=True),
    sa.Column('username', sa.String(length=100), nullable=True),
    sa.Column('hashed_password', sa.String(length=255), nullable=True),
    sa.Column('is_email_verified', sa.Boolean(), nullable=False),
    sa.Column('is_phone_verified', sa.Boolean(), nullable=False),
    sa.Column('first_name', sa.String(length=100), nullable=True),
    sa.Column('last_name', sa.String(length=100), nullable=True),
    sa.Column('full_name', sa.String(length=200), nullable=True),
    sa.Column('avatar_url', sa.String(length=500), nullable=True),
    sa.Column('bio', sa.Text(), nullable=True),
    sa.Column('date_of_birth', sa.DateTime(), nullable=True),
    sa.Column('country', sa.String(length=100), nullable=True),
    sa.Column('city', sa.String(length=100), nullable=True),
    sa.Column('timezone', sa.String(length=50), nullable=False),
    sa.Column('language', sa.String(length=10), nullable=False),
    sa.Column('locale', sa.String(length=10), nullable=False),
    sa.Column('currency', sa.String(length=10), nullable=False),
    sa.Column('role', sa.Enum('GUEST', 'HOST', 'ADMIN', 'SUPER_ADMIN', 'AGENCY', name='userrole'), nullable=False),
    sa.Column('roles', sa.ARRAY(sa.String()), nullable=False),
    sa.Column('status', sa.Enum('ACTIVE', 'INACTIVE', 'SUSPENDED', 'PENDING_VERIFICATION', name='userstatus'), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('agency_id', sa.String(length=40), nullable=True),
    sa.Column('last_login_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('last_login_ip', postgresql.INET(), nullable=True),
    sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['agency_id'], ['agencies.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_user_agency', 'users', ['agency_id', 'is_active'], unique=False)
    op.create_index('idx_user_email_active', 'users', ['email', 'is_active'], unique=False)
    op.create_index('idx_user_role_status', 'users', ['role', 'status'], unique=False)
    op.create_index(op.f('ix_users_agency_id'), 'users', ['agency_id'], unique=False)
    op.create_index(op.f('ix_users_email'), 'users', ['email'], unique=True)
    op.create_index(op.f('ix_users_id'), 'users', ['id'], unique=False)
    op.create_index(op.f('ix_users_is_active'), 'users', ['is_active'], unique=False)
    op.create_index(op.f('ix_users_phone_number'), 'users', ['phone_number'], unique=True)
    op.create_index(op.f('ix_users_role'), 'users', ['role'], unique=False)
    op.create_index(op.f('ix_users_status'), 'users', ['status'], unique=False)
    op.create_index(op.f('ix_users_username'), 'users', ['username'], unique=True)
    op.create_table('accounts',
    sa.Column('user_id', sa.String(length=40), nullable=False),
    sa.Column('provider', sa.Enum('PASSWORD', 'GOOGLE', 'APPLE', 'FACEBOOK', 'GITHUB', name='accountprovider'), nullable=False),
    sa.Column('provider_id', sa.String(length=255), nullable=False),
    sa.Column('access_token', sa.Text(), nullable=True),
    sa.Column('refresh_token', sa.Text(), nullable=True),
    sa.Column('scopes', sa.ARRAY(sa.String()), nullable=False),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_account_provider_unique', 'accounts', ['provider', 'provider_id'], unique=True)
    op.create_index('idx_account_user_provider', 'accounts', ['user_id', 'provider'], unique=False)
    op.create_index(op.f('ix_accounts_id'), 'accounts', ['id'], unique=False)
    op.create_index(op.f('ix_accounts_provider'), 'accounts', ['provider'], unique=False)
    op.create_index(op.f('ix_accounts_provider_id'), 'accounts', ['provider_id'], unique=False)
    op.create_index(op.f('ix_accounts_user_id'), 'accounts', ['user_id'], unique=False)
    op.create_table('analytics_events',
    sa.Column('user_id', sa.String(length=40), nullable=True),
    sa.Column('event_name', sa.String(length=100), nullable=False),
    sa.Column('source', sa.String(length=50), nullable=False),
    sa.Column('payload', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('recorded_at', sa.DateTime(timezone=True), server_default='now()', nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_analytics_event_name_source', 'analytics_events', ['event_name', 'source', 'recorded_at'], unique=False)
    op.create_index('idx_analytics_user_recorded', 'analytics_events', ['user_id', 'recorded_at'], unique=False)
    op.create_index(op.f('ix_analytics_events_event_name'), 'analytics_events', ['event_name'], unique=False)
    op.create_index(op.f('ix_analytics_events_id'), 'analytics_events', ['id'], unique=False)
    op.create_index(op.f('ix_analytics_events_recorded_at'), 'analytics_events', ['recorded_at'], unique=False)
    op.create_index(op.f('ix_analytics_events_source'), 'analytics_events', ['source'], unique=False)
    op.create_index(op.f('ix_analytics_events_user_id'), 'analytics_events', ['user_id'], unique=False)
    op.create_table('audit_logs',
    sa.Column('actor_id', sa.String(length=40), nullable=True),
    sa.Column('action', sa.String(length=100), nullable=False),
    sa.Column('resource', sa.String(length=100), nullable=False),
    sa.Column('resource_id', sa.String(length=255), nullable=True),
    sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['actor_id'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_audit_actor_action', 'audit_logs', ['actor_id', 'action', 'created_at'], unique=False)
    op.create_index('idx_audit_resource', 'audit_logs', ['resource', 'resource_id', 'created_at'], unique=False)
    op.create_index(op.f('ix_audit_logs_action'), 'audit_logs', ['action'], unique=False)
    op.create_index(op.f('ix_audit_logs_actor_id'), 'audit_logs', ['actor_id'], unique=False)
    op.create_index(op.f('ix_audit_logs_id'), 'audit_logs', ['id'], unique=False)
    op.create_index(op.f('ix_audit_logs_resource'), 'audit_logs', ['resource'], unique=False)
    op.create_index(op.f('ix_audit_logs_resource_id'), 'audit_logs', ['resource_id'], unique=False)
    op.create_table('dispute_evidences',
    sa.Column('dispute_id', sa.String(length=40), nullable=False),
    sa.Column('type', sa.String(length=50), nullable=False),
    sa.Column('url', sa.String(length=1000), nullable=True),
    sa.Column('payload', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['dispute_id'], ['disputes.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_dispute_evidence_type', 'dispute_evidences', ['dispute_id', 'type'], unique=False)
    op.create_index(op.f('ix_dispute_evidences_dispute_id'), 'dispute_evidences', ['dispute_id'], unique=False)
    op.create_index(op.f('ix_dispute_evidences_id'), 'dispute_evidences', ['id'], unique=False)
    op.create_table('files',
    sa.Column('filename', sa.String(length=255), nullable=False),
    sa.Column('original_filename', sa.String(length=255), nullable=False),
    sa.Column('file_path', sa.String(length=500), nullable=False),
    sa.Column('file_url', sa.String(length=500), nullable=False),
    sa.Column('file_type', sa.Enum('IMAGE', 'DOCUMENT', 'VIDEO', 'AUDIO', 'OTHER', name='filetype'), nullable=False),
    sa.Column('file_category', sa.Enum('AVATAR', 'LISTING_PHOTO', 'PROPERTY_PHOTO', 'DOCUMENT', 'IDENTIFICATION', 'OTHER', name='filecategory'), nullable=False),
    sa.Column('mime_type', sa.String(length=100), nullable=False),
    sa.Column('file_size', sa.Integer(), nullable=False),
    sa.Column('uploaded_by', sa.String(length=40), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('metadata', sa.Text(), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['uploaded_by'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_files_file_category'), 'files', ['file_category'], unique=False)
    op.create_index(op.f('ix_files_file_type'), 'files', ['file_type'], unique=False)
    op.create_index(op.f('ix_files_id'), 'files', ['id'], unique=False)
    op.create_index(op.f('ix_files_uploaded_by'), 'files', ['uploaded_by'], unique=False)
    op.create_table('host_profiles',
    sa.Column('user_id', sa.String(length=40), nullable=False),
    sa.Column('legal_name', sa.String(length=255), nullable=False),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('badges', sa.ARRAY(sa.String()), nullable=False),
    sa.Column('bio', sa.Text(), nullable=True),
    sa.Column('onboarding_step', sa.String(length=50), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_host_profile_status', 'host_profiles', ['status', 'user_id'], unique=False)
    op.create_index(op.f('ix_host_profiles_id'), 'host_profiles', ['id'], unique=False)
    op.create_index(op.f('ix_host_profiles_status'), 'host_profiles', ['status'], unique=False)
    op.create_index(op.f('ix_host_profiles_user_id'), 'host_profiles', ['user_id'], unique=True)
    op.create_table('loyalty_ledgers',
    sa.Column('user_id', sa.String(length=40), nullable=False),
    sa.Column('program_id', sa.String(length=40), nullable=False),
    sa.Column('balance', sa.Integer(), nullable=False),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('transactions', postgresql.ARRAY(postgresql.JSONB(astext_type=sa.Text())), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['program_id'], ['loyalty_programs.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_loyalty_ledger_user_program', 'loyalty_ledgers', ['user_id', 'program_id'], unique=True)
    op.create_index(op.f('ix_loyalty_ledgers_id'), 'loyalty_ledgers', ['id'], unique=False)
    op.create_index(op.f('ix_loyalty_ledgers_program_id'), 'loyalty_ledgers', ['program_id'], unique=False)
    op.create_index(op.f('ix_loyalty_ledgers_user_id'), 'loyalty_ledgers', ['user_id'], unique=False)
    op.create_table('notifications',
    sa.Column('user_id', sa.String(length=40), nullable=False),
    sa.Column('notification_type', sa.Enum('BOOKING_CONFIRMED', 'BOOKING_CANCELLED', 'BOOKING_PENDING', 'MESSAGE_RECEIVED', 'REVIEW_RECEIVED', 'PAYMENT_RECEIVED', 'PROMOTION', 'SYSTEM', name='notificationtype'), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('message', sa.Text(), nullable=False),
    sa.Column('is_read', sa.Boolean(), nullable=False),
    sa.Column('read_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('sent_email', sa.Boolean(), nullable=False),
    sa.Column('sent_push', sa.Boolean(), nullable=False),
    sa.Column('sent_sms', sa.Boolean(), nullable=False),
    sa.Column('related_entity_type', sa.String(length=50), nullable=True),
    sa.Column('related_entity_id', sa.String(length=40), nullable=True),
    sa.Column('action_url', sa.String(length=500), nullable=True),
    sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_notification_type', 'notifications', ['notification_type', 'created_at'], unique=False)
    op.create_index('idx_notification_user_read', 'notifications', ['user_id', 'is_read', 'created_at'], unique=False)
    op.create_index(op.f('ix_notifications_id'), 'notifications', ['id'], unique=False)
    op.create_index(op.f('ix_notifications_is_read'), 'notifications', ['is_read'], unique=False)
    op.create_index(op.f('ix_notifications_notification_type'), 'notifications', ['notification_type'], unique=False)
    op.create_index(op.f('ix_notifications_user_id'), 'notifications', ['user_id'], unique=False)
    op.create_table('payment_methods',
    sa.Column('user_id', sa.String(length=40), nullable=False),
    sa.Column('provider', sa.String(length=50), nullable=False),
    sa.Column('last4', sa.String(length=4), nullable=True),
    sa.Column('exp_month', sa.Integer(), nullable=True),
    sa.Column('exp_year', sa.Integer(), nullable=True),
    sa.Column('token', sa.String(length=255), nullable=False),
    sa.Column('is_default', sa.Boolean(), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_payment_method_user_default', 'payment_methods', ['user_id', 'is_default'], unique=False)
    op.create_index(op.f('ix_payment_methods_id'), 'payment_methods', ['id'], unique=False)
    op.create_index(op.f('ix_payment_methods_user_id'), 'payment_methods', ['user_id'], unique=False)
    op.create_table('travel_plans',
    sa.Column('user_id', sa.String(length=40), nullable=False),
    sa.Column('destination', sa.String(length=200), nullable=False),
    sa.Column('start_date', sa.Date(), nullable=False),
    sa.Column('end_date', sa.Date(), nullable=False),
    sa.Column('duration_days', sa.Integer(), nullable=False),
    sa.Column('budget', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.String(length=10), nullable=False),
    sa.Column('travelers_count', sa.Integer(), nullable=False),
    sa.Column('travel_style', sa.String(length=50), nullable=True),
    sa.Column('preferences', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('plan_title', sa.String(length=200), nullable=True),
    sa.Column('plan_summary', sa.Text(), nullable=True),
    sa.Column('daily_itinerary', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('recommended_listings', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('recommended_properties', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('recommended_activities', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('recommended_restaurants', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('transportation_suggestions', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('estimated_accommodation_cost', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('estimated_activities_cost', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('estimated_food_cost', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('estimated_transportation_cost', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('total_estimated_cost', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('is_saved', sa.Boolean(), nullable=False),
    sa.Column('is_booked', sa.Boolean(), nullable=False),
    sa.Column('ai_model_used', sa.String(length=50), nullable=True),
    sa.Column('ai_prompt', sa.Text(), nullable=True),
    sa.Column('ai_response', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_travel_plan_dates', 'travel_plans', ['start_date', 'end_date'], unique=False)
    op.create_index('idx_travel_plan_user_saved', 'travel_plans', ['user_id', 'is_saved'], unique=False)
    op.create_index(op.f('ix_travel_plans_id'), 'travel_plans', ['id'], unique=False)
    op.create_index(op.f('ix_travel_plans_is_booked'), 'travel_plans', ['is_booked'], unique=False)
    op.create_index(op.f('ix_travel_plans_is_saved'), 'travel_plans', ['is_saved'], unique=False)
    op.create_index(op.f('ix_travel_plans_user_id'), 'travel_plans', ['user_id'], unique=False)
    op.create_table('two_factor_challenges',
    sa.Column('user_id', sa.String(length=40), nullable=False),
    sa.Column('secret', sa.String(length=255), nullable=False),
    sa.Column('method', sa.String(length=50), nullable=False),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('consumed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_2fa_user_expires', 'two_factor_challenges', ['user_id', 'expires_at', 'consumed_at'], unique=False)
    op.create_index(op.f('ix_two_factor_challenges_id'), 'two_factor_challenges', ['id'], unique=False)
    op.create_index(op.f('ix_two_factor_challenges_user_id'), 'two_factor_challenges', ['user_id'], unique=False)
    op.create_table('user_devices',
    sa.Column('user_id', sa.String(length=40), nullable=False),
    sa.Column('platform', sa.String(length=50), nullable=False),
    sa.Column('fingerprint', sa.String(length=255), nullable=False),
    sa.Column('last_seen_at', sa.DateTime(timezone=True), server_default='now()', nullable=False),
    sa.Column('is_trusted', sa.Boolean(), nullable=False),
    sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_device_user_fingerprint', 'user_devices', ['user_id', 'fingerprint'], unique=False)
    op.create_index(op.f('ix_user_devices_fingerprint'), 'user_devices', ['fingerprint'], unique=False)
    op.create_index(op.f('ix_user_devices_id'), 'user_devices', ['id'], unique=False)
    op.create_index(op.f('ix_user_devices_user_id'), 'user_devices', ['user_id'], unique=False)
    op.create_table('user_passkeys',
    sa.Column('user_id', sa.String(length=40), nullable=False),
    sa.Column('credential_id', sa.String(length=255), nullable=False),
    sa.Column('public_key', sa.Text(), nullable=False),
    sa.Column('backed_up', sa.Boolean(), nullable=False),
    sa.Column('transports', sa.ARRAY(sa.String()), nullable=False),
    sa.Column('sign_count', sa.Integer(), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_passkey_user_credential', 'user_passkeys', ['user_id', 'credential_id'], unique=False)
    op.create_index(op.f('ix_user_passkeys_credential_id'), 'user_passkeys', ['credential_id'], unique=True)
    op.create_index(op.f('ix_user_passkeys_id'), 'user_passkeys', ['id'], unique=False)
    op.create_index(op.f('ix_user_passkeys_user_id'), 'user_passkeys', ['user_id'], unique=False)
    op.create_table('user_verifications',
    sa.Column('user_id', sa.String(length=40), nullable=False),
    sa.Column('verification_type', sa.String(length=50), nullable=False),
    sa.Column('code', sa.String(length=10), nullable=False),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('is_used', sa.Boolean(), nullable=False),
    sa.Column('attempts', sa.Integer(), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_verification_user_type', 'user_verifications', ['user_id', 'verification_type', 'is_used'], unique=False)
    op.create_index(op.f('ix_user_verifications_id'), 'user_verifications', ['id'], unique=False)
    op.create_index(op.f('ix_user_verifications_user_id'), 'user_verifications', ['user_id'], unique=False)
    op.create_table('co_hosts',
    sa.Column('host_id', sa.String(length=40), nullable=False),
    sa.Column('email', sa.String(length=255), nullable=False),
    sa.Column('role', sa.String(length=50), nullable=False),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['host_id'], ['host_profiles.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_cohost_host_status', 'co_hosts', ['host_id', 'status'], unique=False)
    op.create_index(op.f('ix_co_hosts_email'), 'co_hosts', ['email'], unique=False)
    op.create_index(op.f('ix_co_hosts_host_id'), 'co_hosts', ['host_id'], unique=False)
    op.create_index(op.f('ix_co_hosts_id'), 'co_hosts', ['id'], unique=False)
    op.create_index(op.f('ix_co_hosts_status'), 'co_hosts', ['status'], unique=False)
    op.create_table('listings',
    sa.Column('title', sa.String(length=500), nullable=False),
    sa.Column('slug', sa.String(length=500), nullable=False),
    sa.Column('summary', sa.String(length=500), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('listing_type', sa.String(length=50), nullable=False),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('host_id', sa.String(length=40), nullable=True),
    sa.Column('host_profile_id', sa.String(length=40), nullable=True),
    sa.Column('agency_id', sa.String(length=40), nullable=True),
    sa.Column('address_line1', sa.String(length=500), nullable=False),
    sa.Column('address_line2', sa.String(length=500), nullable=True),
    sa.Column('city', sa.String(length=100), nullable=False),
    sa.Column('state', sa.String(length=100), nullable=True),
    sa.Column('country', sa.String(length=100), nullable=False),
    sa.Column('postal_code', sa.String(length=20), nullable=True),
    sa.Column('address', sa.Text(), nullable=True),
    sa.Column('latitude', sa.Numeric(precision=10, scale=8), nullable=True),
    sa.Column('longitude', sa.Numeric(precision=11, scale=8), nullable=True),
    sa.Column('capacity', sa.Integer(), nullable=False),
    sa.Column('bedrooms', sa.Integer(), nullable=False),
    sa.Column('beds', sa.Integer(), nullable=False),
    sa.Column('bathrooms', sa.Numeric(precision=3, scale=1), nullable=False),
    sa.Column('max_guests', sa.Integer(), nullable=False),
    sa.Column('square_meters', sa.Integer(), nullable=True),
    sa.Column('base_price', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.String(length=10), nullable=False),
    sa.Column('cleaning_fee', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('service_fee', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('security_deposit', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('booking_type', sa.Enum('INSTANT', 'REQUEST', name='bookingtype'), nullable=False),
    sa.Column('min_stay_nights', sa.Integer(), nullable=False),
    sa.Column('max_stay_nights', sa.Integer(), nullable=True),
    sa.Column('check_in_time', sa.String(length=10), nullable=False),
    sa.Column('check_out_time', sa.String(length=10), nullable=False),
    sa.Column('rating', sa.Numeric(precision=3, scale=2), nullable=False),
    sa.Column('review_count', sa.Integer(), nullable=False),
    sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['agency_id'], ['agencies.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['host_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['host_profile_id'], ['host_profiles.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_listing_city_country', 'listings', ['city', 'country', 'status'], unique=False)
    op.create_index('idx_listing_host_profile_status', 'listings', ['host_profile_id', 'status'], unique=False)
    op.create_index('idx_listing_host_status', 'listings', ['host_id', 'status'], unique=False)
    op.create_index('idx_listing_location', 'listings', ['latitude', 'longitude'], unique=False)
    op.create_index('idx_listing_rating', 'listings', ['rating', 'review_count'], unique=False)
    op.create_index('idx_listing_type_status', 'listings', ['listing_type', 'status'], unique=False)
    op.create_index(op.f('ix_listings_agency_id'), 'listings', ['agency_id'], unique=False)
    op.create_index(op.f('ix_listings_city'), 'listings', ['city'], unique=False)
    op.create_index(op.f('ix_listings_country'), 'listings', ['country'], unique=False)
    op.create_index(op.f('ix_listings_host_id'), 'listings', ['host_id'], unique=False)
    op.create_index(op.f('ix_listings_host_profile_id'), 'listings', ['host_profile_id'], unique=False)
    op.create_index(op.f('ix_listings_id'), 'listings', ['id'], unique=False)
    op.create_index(op.f('ix_listings_listing_type'), 'listings', ['listing_type'], unique=False)
    op.create_index(op.f('ix_listings_rating'), 'listings', ['rating'], unique=False)
    op.create_index(op.f('ix_listings_slug'), 'listings', ['slug'], unique=True)
    op.create_index(op.f('ix_listings_status'), 'listings', ['status'], unique=False)
    op.create_index(op.f('ix_listings_title'), 'listings', ['title'], unique=False)
    op.create_table('payouts',
    sa.Column('host_profile_id', sa.String(length=40), nullable=False),
    sa.Column('host_id', sa.String(length=40), nullable=True),
    sa.Column('booking_id', sa.String(length=40), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('amount', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.String(length=10), nullable=False),
    sa.Column('destination', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('batch_id', sa.String(length=40), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['batch_id'], ['payout_batches.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['booking_id'], ['bookings.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['host_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['host_profile_id'], ['host_profiles.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_payout_batch', 'payouts', ['batch_id', 'status'], unique=False)
    op.create_index('idx_payout_host_status', 'payouts', ['host_profile_id', 'status'], unique=False)
    op.create_index(op.f('ix_payouts_batch_id'), 'payouts', ['batch_id'], unique=False)
    op.create_index(op.f('ix_payouts_booking_id'), 'payouts', ['booking_id'], unique=False)
    op.create_index(op.f('ix_payouts_host_id'), 'payouts', ['host_id'], unique=False)
    op.create_index(op.f('ix_payouts_host_profile_id'), 'payouts', ['host_profile_id'], unique=False)
    op.create_index(op.f('ix_payouts_id'), 'payouts', ['id'], unique=False)
    op.create_index(op.f('ix_payouts_status'), 'payouts', ['status'], unique=False)
    op.create_table('tax_documents',
    sa.Column('host_id', sa.String(length=40), nullable=False),
    sa.Column('type', sa.String(length=50), nullable=False),
    sa.Column('identifier', sa.String(length=255), nullable=False),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('issued_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['host_id'], ['host_profiles.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_tax_doc_host_status', 'tax_documents', ['host_id', 'status'], unique=False)
    op.create_index(op.f('ix_tax_documents_host_id'), 'tax_documents', ['host_id'], unique=False)
    op.create_index(op.f('ix_tax_documents_id'), 'tax_documents', ['id'], unique=False)
    op.create_index(op.f('ix_tax_documents_status'), 'tax_documents', ['status'], unique=False)
    op.create_table('travel_plan_bookings',
    sa.Column('travel_plan_id', sa.String(length=40), nullable=False),
    sa.Column('booking_id', sa.String(length=40), nullable=False),
    sa.Column('day_number', sa.Integer(), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['booking_id'], ['bookings.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['travel_plan_id'], ['travel_plans.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_travel_plan_booking', 'travel_plan_bookings', ['travel_plan_id', 'booking_id'], unique=True)
    op.create_index(op.f('ix_travel_plan_bookings_booking_id'), 'travel_plan_bookings', ['booking_id'], unique=False)
    op.create_index(op.f('ix_travel_plan_bookings_id'), 'travel_plan_bookings', ['id'], unique=False)
    op.create_index(op.f('ix_travel_plan_bookings_travel_plan_id'), 'travel_plan_bookings', ['travel_plan_id'], unique=False)
    op.create_table('blocked_dates',
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('date', sa.Date(), nullable=False),
    sa.Column('reason', sa.String(length=500), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_blocked_date_listing_date', 'blocked_dates', ['listing_id', 'date'], unique=True)
    op.create_index(op.f('ix_blocked_dates_date'), 'blocked_dates', ['date'], unique=False)
    op.create_index(op.f('ix_blocked_dates_id'), 'blocked_dates', ['id'], unique=False)
    op.create_index(op.f('ix_blocked_dates_listing_id'), 'blocked_dates', ['listing_id'], unique=False)
    op.create_table('calendars',
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('external_ical_urls', sa.ARRAY(sa.String()), nullable=False),
    sa.Column('availability_windows', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_calendars_id'), 'calendars', ['id'], unique=False)
    op.create_index(op.f('ix_calendars_listing_id'), 'calendars', ['listing_id'], unique=True)
    op.create_table('conversations',
    sa.Column('booking_id', sa.String(length=40), nullable=True),
    sa.Column('listing_id', sa.String(length=40), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['booking_id'], ['bookings.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_conversation_booking', 'conversations', ['booking_id'], unique=False)
    op.create_index('idx_conversation_listing', 'conversations', ['listing_id'], unique=False)
    op.create_index(op.f('ix_conversations_booking_id'), 'conversations', ['booking_id'], unique=False)
    op.create_index(op.f('ix_conversations_id'), 'conversations', ['id'], unique=False)
    op.create_index(op.f('ix_conversations_listing_id'), 'conversations', ['listing_id'], unique=False)
    op.create_table('counter_offers',
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('guest_id', sa.String(length=40), nullable=False),
    sa.Column('check_in_date', sa.Date(), nullable=False),
    sa.Column('check_out_date', sa.Date(), nullable=False),
    sa.Column('nights', sa.Integer(), nullable=False),
    sa.Column('adults', sa.Integer(), nullable=False),
    sa.Column('children', sa.Integer(), nullable=False),
    sa.Column('offered_price', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.String(length=10), nullable=False),
    sa.Column('message', sa.Text(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('responded_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('booking_id', sa.String(length=40), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['booking_id'], ['bookings.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['guest_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_counter_offer_expires', 'counter_offers', ['expires_at', 'status'], unique=False)
    op.create_index('idx_counter_offer_listing_guest', 'counter_offers', ['listing_id', 'guest_id', 'status'], unique=False)
    op.create_index(op.f('ix_counter_offers_expires_at'), 'counter_offers', ['expires_at'], unique=False)
    op.create_index(op.f('ix_counter_offers_guest_id'), 'counter_offers', ['guest_id'], unique=False)
    op.create_index(op.f('ix_counter_offers_id'), 'counter_offers', ['id'], unique=False)
    op.create_index(op.f('ix_counter_offers_listing_id'), 'counter_offers', ['listing_id'], unique=False)
    op.create_index(op.f('ix_counter_offers_status'), 'counter_offers', ['status'], unique=False)
    op.create_table('listing_amenities',
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('amenity_id', sa.String(length=40), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['amenity_id'], ['amenities.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_listing_amenity_unique', 'listing_amenities', ['listing_id', 'amenity_id'], unique=True)
    op.create_index(op.f('ix_listing_amenities_amenity_id'), 'listing_amenities', ['amenity_id'], unique=False)
    op.create_index(op.f('ix_listing_amenities_id'), 'listing_amenities', ['id'], unique=False)
    op.create_index(op.f('ix_listing_amenities_listing_id'), 'listing_amenities', ['listing_id'], unique=False)
    op.create_table('listing_availability',
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('date', sa.Date(), nullable=False),
    sa.Column('is_available', sa.Boolean(), nullable=False),
    sa.Column('price_override', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('min_stay_override', sa.Integer(), nullable=True),
    sa.Column('notes', sa.String(length=500), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_availability_date_available', 'listing_availability', ['date', 'is_available'], unique=False)
    op.create_index('idx_availability_listing_date', 'listing_availability', ['listing_id', 'date'], unique=True)
    op.create_index(op.f('ix_listing_availability_date'), 'listing_availability', ['date'], unique=False)
    op.create_index(op.f('ix_listing_availability_id'), 'listing_availability', ['id'], unique=False)
    op.create_index(op.f('ix_listing_availability_listing_id'), 'listing_availability', ['listing_id'], unique=False)
    op.create_table('listing_drafts',
    sa.Column('listing_id', sa.String(length=40), nullable=True),
    sa.Column('host_profile_id', sa.String(length=40), nullable=False),
    sa.Column('payload', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('version', sa.Integer(), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['host_profile_id'], ['host_profiles.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_listing_drafts_host_profile_id'), 'listing_drafts', ['host_profile_id'], unique=False)
    op.create_index(op.f('ix_listing_drafts_id'), 'listing_drafts', ['id'], unique=False)
    op.create_index(op.f('ix_listing_drafts_listing_id'), 'listing_drafts', ['listing_id'], unique=True)
    op.create_table('listing_images',
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('url', sa.String(length=1000), nullable=False),
    sa.Column('caption', sa.String(length=500), nullable=True),
    sa.Column('position', sa.Integer(), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_image_listing_position', 'listing_images', ['listing_id', 'position'], unique=False)
    op.create_index(op.f('ix_listing_images_id'), 'listing_images', ['id'], unique=False)
    op.create_index(op.f('ix_listing_images_listing_id'), 'listing_images', ['listing_id'], unique=False)
    op.create_table('listing_locations',
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('timezone', sa.String(length=50), nullable=False),
    sa.Column('neighborhood', sa.String(length=200), nullable=True),
    sa.Column('coordinates', geoalchemy2.types.Geography(geometry_type='POINT', srid=4326, from_text='ST_GeogFromText', name='geography', nullable=False), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_listing_location_coords', 'listing_locations', ['coordinates'], unique=False, postgresql_using='gist')
    op.create_index('idx_listing_locations_coordinates', 'listing_locations', ['coordinates'], unique=False, postgresql_using='gist')
    op.create_index(op.f('ix_listing_locations_id'), 'listing_locations', ['id'], unique=False)
    op.create_index(op.f('ix_listing_locations_listing_id'), 'listing_locations', ['listing_id'], unique=True)
    op.create_table('listing_photos',
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('url', sa.String(length=1000), nullable=False),
    sa.Column('thumbnail_url', sa.String(length=1000), nullable=True),
    sa.Column('caption', sa.String(length=500), nullable=True),
    sa.Column('display_order', sa.Integer(), nullable=False),
    sa.Column('position', sa.Integer(), nullable=False),
    sa.Column('is_primary', sa.Boolean(), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_photo_listing_order', 'listing_photos', ['listing_id', 'display_order'], unique=False)
    op.create_index(op.f('ix_listing_photos_id'), 'listing_photos', ['id'], unique=False)
    op.create_index(op.f('ix_listing_photos_listing_id'), 'listing_photos', ['listing_id'], unique=False)
    op.create_table('listing_rules',
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('key', sa.String(length=50), nullable=False),
    sa.Column('rule_type', sa.String(length=50), nullable=True),
    sa.Column('value', sa.String(length=500), nullable=False),
    sa.Column('rule_value', sa.String(length=500), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_listing_rules_id'), 'listing_rules', ['id'], unique=False)
    op.create_index(op.f('ix_listing_rules_listing_id'), 'listing_rules', ['listing_id'], unique=False)
    op.create_table('price_calendars',
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('date', sa.Date(), nullable=False),
    sa.Column('nightly_rate', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.String(length=10), nullable=False),
    sa.Column('min_stay', sa.Integer(), nullable=False),
    sa.Column('is_blocked', sa.Boolean(), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_price_calendar_listing_date', 'price_calendars', ['listing_id', 'date'], unique=True)
    op.create_index(op.f('ix_price_calendars_date'), 'price_calendars', ['date'], unique=False)
    op.create_index(op.f('ix_price_calendars_id'), 'price_calendars', ['id'], unique=False)
    op.create_index(op.f('ix_price_calendars_listing_id'), 'price_calendars', ['listing_id'], unique=False)
    op.create_table('pricing_models',
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('strategy', sa.String(length=50), nullable=False),
    sa.Column('provider', sa.String(length=50), nullable=False),
    sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_pricing_models_id'), 'pricing_models', ['id'], unique=False)
    op.create_index(op.f('ix_pricing_models_listing_id'), 'pricing_models', ['listing_id'], unique=True)
    op.create_table('pricing_rules',
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('rule_type', sa.String(length=50), nullable=False),
    sa.Column('start_date', sa.Date(), nullable=True),
    sa.Column('end_date', sa.Date(), nullable=True),
    sa.Column('day_of_week', sa.Integer(), nullable=True),
    sa.Column('price_modifier', sa.Numeric(precision=5, scale=2), nullable=False),
    sa.Column('modifier_type', sa.String(length=20), nullable=False),
    sa.Column('min_nights', sa.Integer(), nullable=True),
    sa.Column('max_nights', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_pricing_listing_active', 'pricing_rules', ['listing_id', 'is_active'], unique=False)
    op.create_index('idx_pricing_listing_dates', 'pricing_rules', ['listing_id', 'start_date', 'end_date'], unique=False)
    op.create_index(op.f('ix_pricing_rules_id'), 'pricing_rules', ['id'], unique=False)
    op.create_index(op.f('ix_pricing_rules_listing_id'), 'pricing_rules', ['listing_id'], unique=False)
    op.create_table('promotions',
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('promotion_type', sa.Enum('FLASH_SALE', 'COUPON', 'GROUP_DISCOUNT', 'LAST_MINUTE', 'SEASONAL', 'LOYALTY', name='promotiontype'), nullable=False),
    sa.Column('discount_type', sa.Enum('PERCENTAGE', 'FIXED_AMOUNT', 'FREE_NIGHTS', name='discounttype'), nullable=False),
    sa.Column('discount_value', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('max_discount_amount', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('start_date', sa.Date(), nullable=False),
    sa.Column('end_date', sa.Date(), nullable=False),
    sa.Column('start_time', sa.String(length=10), nullable=True),
    sa.Column('end_time', sa.String(length=10), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('listing_id', sa.String(length=40), nullable=True),
    sa.Column('agency_id', sa.String(length=40), nullable=True),
    sa.Column('min_nights', sa.Integer(), nullable=True),
    sa.Column('max_nights', sa.Integer(), nullable=True),
    sa.Column('min_guests', sa.Integer(), nullable=True),
    sa.Column('advance_booking_days', sa.Integer(), nullable=True),
    sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['agency_id'], ['agencies.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_promotion_listing', 'promotions', ['listing_id', 'is_active'], unique=False)
    op.create_index('idx_promotion_type_dates', 'promotions', ['promotion_type', 'start_date', 'end_date', 'is_active'], unique=False)
    op.create_index(op.f('ix_promotions_agency_id'), 'promotions', ['agency_id'], unique=False)
    op.create_index(op.f('ix_promotions_end_date'), 'promotions', ['end_date'], unique=False)
    op.create_index(op.f('ix_promotions_id'), 'promotions', ['id'], unique=False)
    op.create_index(op.f('ix_promotions_is_active'), 'promotions', ['is_active'], unique=False)
    op.create_index(op.f('ix_promotions_listing_id'), 'promotions', ['listing_id'], unique=False)
    op.create_index(op.f('ix_promotions_promotion_type'), 'promotions', ['promotion_type'], unique=False)
    op.create_index(op.f('ix_promotions_start_date'), 'promotions', ['start_date'], unique=False)
    op.create_table('reviews',
    sa.Column('booking_id', sa.String(length=40), nullable=True),
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('guest_id', sa.String(length=40), nullable=False),
    sa.Column('host_id', sa.String(length=40), nullable=False),
    sa.Column('overall_rating', sa.Numeric(precision=2, scale=1), nullable=False),
    sa.Column('cleanliness_rating', sa.Numeric(precision=2, scale=1), nullable=True),
    sa.Column('communication_rating', sa.Numeric(precision=2, scale=1), nullable=True),
    sa.Column('check_in_rating', sa.Numeric(precision=2, scale=1), nullable=True),
    sa.Column('accuracy_rating', sa.Numeric(precision=2, scale=1), nullable=True),
    sa.Column('location_rating', sa.Numeric(precision=2, scale=1), nullable=True),
    sa.Column('value_rating', sa.Numeric(precision=2, scale=1), nullable=True),
    sa.Column('title', sa.String(length=200), nullable=True),
    sa.Column('comment', sa.Text(), nullable=True),
    sa.Column('is_verified', sa.Boolean(), nullable=False),
    sa.Column('is_public', sa.Boolean(), nullable=False),
    sa.Column('is_featured', sa.Boolean(), nullable=False),
    sa.Column('moderation_status', sa.String(length=20), nullable=False),
    sa.Column('moderation_notes', sa.Text(), nullable=True),
    sa.Column('host_response', sa.Text(), nullable=True),
    sa.Column('host_response_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('visibility', sa.String(length=50), nullable=False),
    sa.Column('helpful_count', sa.Integer(), nullable=False),
    sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.CheckConstraint('overall_rating >= 1 AND overall_rating <= 5', name='check_overall_rating'),
    sa.ForeignKeyConstraint(['booking_id'], ['bookings.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['guest_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['host_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_review_listing_guest', 'reviews', ['listing_id', 'guest_id'], unique=True)
    op.create_index('idx_review_listing_rating', 'reviews', ['listing_id', 'overall_rating'], unique=False)
    op.create_index('idx_review_moderation', 'reviews', ['moderation_status', 'is_public'], unique=False)
    op.create_index(op.f('ix_reviews_booking_id'), 'reviews', ['booking_id'], unique=False)
    op.create_index(op.f('ix_reviews_guest_id'), 'reviews', ['guest_id'], unique=False)
    op.create_index(op.f('ix_reviews_host_id'), 'reviews', ['host_id'], unique=False)
    op.create_index(op.f('ix_reviews_id'), 'reviews', ['id'], unique=False)
    op.create_index(op.f('ix_reviews_listing_id'), 'reviews', ['listing_id'], unique=False)
    op.create_table('search_snapshots',
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('payload', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('indexed_at', sa.DateTime(timezone=True), server_default='now()', nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_search_snapshot_indexed', 'search_snapshots', ['indexed_at'], unique=False)
    op.create_index(op.f('ix_search_snapshots_id'), 'search_snapshots', ['id'], unique=False)
    op.create_index(op.f('ix_search_snapshots_indexed_at'), 'search_snapshots', ['indexed_at'], unique=False)
    op.create_index(op.f('ix_search_snapshots_listing_id'), 'search_snapshots', ['listing_id'], unique=True)
    op.create_table('seasonal_overrides',
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('starts_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('ends_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('min_nights', sa.Integer(), nullable=True),
    sa.Column('max_nights', sa.Integer(), nullable=True),
    sa.Column('price_factor', sa.Numeric(precision=5, scale=2), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_seasonal_override_dates', 'seasonal_overrides', ['starts_at', 'ends_at'], unique=False)
    op.create_index(op.f('ix_seasonal_overrides_ends_at'), 'seasonal_overrides', ['ends_at'], unique=False)
    op.create_index(op.f('ix_seasonal_overrides_id'), 'seasonal_overrides', ['id'], unique=False)
    op.create_index(op.f('ix_seasonal_overrides_listing_id'), 'seasonal_overrides', ['listing_id'], unique=False)
    op.create_index(op.f('ix_seasonal_overrides_starts_at'), 'seasonal_overrides', ['starts_at'], unique=False)
    op.create_table('wishlists',
    sa.Column('user_id', sa.String(length=40), nullable=False),
    sa.Column('listing_id', sa.String(length=40), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_wishlist_user_listing', 'wishlists', ['user_id', 'listing_id'], unique=True)
    op.create_index(op.f('ix_wishlists_id'), 'wishlists', ['id'], unique=False)
    op.create_index(op.f('ix_wishlists_listing_id'), 'wishlists', ['listing_id'], unique=False)
    op.create_index(op.f('ix_wishlists_user_id'), 'wishlists', ['user_id'], unique=False)
    op.create_table('availability_windows',
    sa.Column('calendar_id', sa.String(length=40), nullable=False),
    sa.Column('starts_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('ends_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('reason', sa.String(length=500), nullable=True),
    sa.Column('source', sa.String(length=50), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['calendar_id'], ['calendars.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_availability_window_dates', 'availability_windows', ['starts_at', 'ends_at'], unique=False)
    op.create_index(op.f('ix_availability_windows_calendar_id'), 'availability_windows', ['calendar_id'], unique=False)
    op.create_index(op.f('ix_availability_windows_ends_at'), 'availability_windows', ['ends_at'], unique=False)
    op.create_index(op.f('ix_availability_windows_id'), 'availability_windows', ['id'], unique=False)
    op.create_index(op.f('ix_availability_windows_starts_at'), 'availability_windows', ['starts_at'], unique=False)
    op.create_table('conversation_participants',
    sa.Column('conversation_id', sa.String(length=40), nullable=False),
    sa.Column('user_id', sa.String(length=40), nullable=False),
    sa.ForeignKeyConstraint(['conversation_id'], ['conversations.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('conversation_id', 'user_id')
    )
    op.create_index('idx_conv_participants', 'conversation_participants', ['conversation_id', 'user_id'], unique=False)
    op.create_table('message_automations',
    sa.Column('conversation_id', sa.String(length=40), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('type', sa.String(length=50), nullable=False),
    sa.Column('config', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('last_run_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['conversation_id'], ['conversations.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_automation_conversation_type', 'message_automations', ['conversation_id', 'type'], unique=False)
    op.create_index(op.f('ix_message_automations_conversation_id'), 'message_automations', ['conversation_id'], unique=False)
    op.create_index(op.f('ix_message_automations_id'), 'message_automations', ['id'], unique=False)
    op.create_table('messages',
    sa.Column('conversation_id', sa.String(length=40), nullable=True),
    sa.Column('sender_id', sa.String(length=40), nullable=True),
    sa.Column('receiver_id', sa.String(length=40), nullable=True),
    sa.Column('listing_id', sa.String(length=40), nullable=True),
    sa.Column('booking_id', sa.String(length=40), nullable=True),
    sa.Column('source', sa.String(length=50), nullable=False),
    sa.Column('subject', sa.String(length=500), nullable=True),
    sa.Column('body', sa.Text(), nullable=False),
    sa.Column('content', sa.Text(), nullable=True),
    sa.Column('is_read', sa.Boolean(), nullable=False),
    sa.Column('read_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('attachments', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['booking_id'], ['bookings.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['conversation_id'], ['conversations.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['listing_id'], ['listings.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['receiver_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['sender_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_message_booking', 'messages', ['booking_id', 'created_at'], unique=False)
    op.create_index('idx_message_conversation', 'messages', ['conversation_id', 'created_at'], unique=False)
    op.create_index('idx_message_sender_receiver', 'messages', ['sender_id', 'receiver_id', 'is_read'], unique=False)
    op.create_index(op.f('ix_messages_booking_id'), 'messages', ['booking_id'], unique=False)
    op.create_index(op.f('ix_messages_conversation_id'), 'messages', ['conversation_id'], unique=False)
    op.create_index(op.f('ix_messages_id'), 'messages', ['id'], unique=False)
    op.create_index(op.f('ix_messages_is_read'), 'messages', ['is_read'], unique=False)
    op.create_index(op.f('ix_messages_listing_id'), 'messages', ['listing_id'], unique=False)
    op.create_index(op.f('ix_messages_receiver_id'), 'messages', ['receiver_id'], unique=False)
    op.create_index(op.f('ix_messages_sender_id'), 'messages', ['sender_id'], unique=False)
    op.create_table('pricing_model_rules',
    sa.Column('pricing_model_id', sa.String(length=40), nullable=False),
    sa.Column('type', sa.String(length=50), nullable=False),
    sa.Column('payload', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['pricing_model_id'], ['pricing_models.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_pricing_model_rules_id'), 'pricing_model_rules', ['id'], unique=False)
    op.create_index(op.f('ix_pricing_model_rules_pricing_model_id'), 'pricing_model_rules', ['pricing_model_id'], unique=False)
    op.create_table('promotion_redemptions',
    sa.Column('promotion_id', sa.String(length=40), nullable=False),
    sa.Column('user_id', sa.String(length=40), nullable=False),
    sa.Column('booking_id', sa.String(length=40), nullable=True),
    sa.Column('amount', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['booking_id'], ['bookings.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['promotion_id'], ['promotions.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_promotion_redemption_unique', 'promotion_redemptions', ['promotion_id', 'user_id', 'booking_id'], unique=True)
    op.create_index(op.f('ix_promotion_redemptions_booking_id'), 'promotion_redemptions', ['booking_id'], unique=False)
    op.create_index(op.f('ix_promotion_redemptions_id'), 'promotion_redemptions', ['id'], unique=False)
    op.create_index(op.f('ix_promotion_redemptions_promotion_id'), 'promotion_redemptions', ['promotion_id'], unique=False)
    op.create_index(op.f('ix_promotion_redemptions_user_id'), 'promotion_redemptions', ['user_id'], unique=False)
    op.create_table('review_helpful',
    sa.Column('review_id', sa.String(length=40), nullable=False),
    sa.Column('user_id', sa.String(length=40), nullable=False),
    sa.Column('is_helpful', sa.Boolean(), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['review_id'], ['reviews.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_review_helpful_unique', 'review_helpful', ['review_id', 'user_id'], unique=True)
    op.create_index(op.f('ix_review_helpful_id'), 'review_helpful', ['id'], unique=False)
    op.create_index(op.f('ix_review_helpful_review_id'), 'review_helpful', ['review_id'], unique=False)
    op.create_index(op.f('ix_review_helpful_user_id'), 'review_helpful', ['user_id'], unique=False)
    op.create_table('review_responses',
    sa.Column('review_id', sa.String(length=40), nullable=False),
    sa.Column('host_profile_id', sa.String(length=40), nullable=False),
    sa.Column('comment', sa.Text(), nullable=False),
    sa.Column('id', sa.String(length=40), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['host_profile_id'], ['host_profiles.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['review_id'], ['reviews.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_review_response_review', 'review_responses', ['review_id'], unique=False)
    op.create_index(op.f('ix_review_responses_host_profile_id'), 'review_responses', ['host_profile_id'], unique=False)
    op.create_index(op.f('ix_review_responses_id'), 'review_responses', ['id'], unique=False)
    op.create_index(op.f('ix_review_responses_review_id'), 'review_responses', ['review_id'], unique=True)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_review_responses_review_id'), table_name='review_responses')
    op.drop_index(op.f('ix_review_responses_id'), table_name='review_responses')
    op.drop_index(op.f('ix_review_responses_host_profile_id'), table_name='review_responses')
    op.drop_index('idx_review_response_review', table_name='review_responses')
    op.drop_table('review_responses')
    op.drop_index(op.f('ix_review_helpful_user_id'), table_name='review_helpful')
    op.drop_index(op.f('ix_review_helpful_review_id'), table_name='review_helpful')
    op.drop_index(op.f('ix_review_helpful_id'), table_name='review_helpful')
    op.drop_index('idx_review_helpful_unique', table_name='review_helpful')
    op.drop_table('review_helpful')
    op.drop_index(op.f('ix_promotion_redemptions_user_id'), table_name='promotion_redemptions')
    op.drop_index(op.f('ix_promotion_redemptions_promotion_id'), table_name='promotion_redemptions')
    op.drop_index(op.f('ix_promotion_redemptions_id'), table_name='promotion_redemptions')
    op.drop_index(op.f('ix_promotion_redemptions_booking_id'), table_name='promotion_redemptions')
    op.drop_index('idx_promotion_redemption_unique', table_name='promotion_redemptions')
    op.drop_table('promotion_redemptions')
    op.drop_index(op.f('ix_pricing_model_rules_pricing_model_id'), table_name='pricing_model_rules')
    op.drop_index(op.f('ix_pricing_model_rules_id'), table_name='pricing_model_rules')
    op.drop_table('pricing_model_rules')
    op.drop_index(op.f('ix_messages_sender_id'), table_name='messages')
    op.drop_index(op.f('ix_messages_receiver_id'), table_name='messages')
    op.drop_index(op.f('ix_messages_listing_id'), table_name='messages')
    op.drop_index(op.f('ix_messages_is_read'), table_name='messages')
    op.drop_index(op.f('ix_messages_id'), table_name='messages')
    op.drop_index(op.f('ix_messages_conversation_id'), table_name='messages')
    op.drop_index(op.f('ix_messages_booking_id'), table_name='messages')
    op.drop_index('idx_message_sender_receiver', table_name='messages')
    op.drop_index('idx_message_conversation', table_name='messages')
    op.drop_index('idx_message_booking', table_name='messages')
    op.drop_table('messages')
    op.drop_index(op.f('ix_message_automations_id'), table_name='message_automations')
    op.drop_index(op.f('ix_message_automations_conversation_id'), table_name='message_automations')
    op.drop_index('idx_automation_conversation_type', table_name='message_automations')
    op.drop_table('message_automations')
    op.drop_index('idx_conv_participants', table_name='conversation_participants')
    op.drop_table('conversation_participants')
    op.drop_index(op.f('ix_availability_windows_starts_at'), table_name='availability_windows')
    op.drop_index(op.f('ix_availability_windows_id'), table_name='availability_windows')
    op.drop_index(op.f('ix_availability_windows_ends_at'), table_name='availability_windows')
    op.drop_index(op.f('ix_availability_windows_calendar_id'), table_name='availability_windows')
    op.drop_index('idx_availability_window_dates', table_name='availability_windows')
    op.drop_table('availability_windows')
    op.drop_index(op.f('ix_wishlists_user_id'), table_name='wishlists')
    op.drop_index(op.f('ix_wishlists_listing_id'), table_name='wishlists')
    op.drop_index(op.f('ix_wishlists_id'), table_name='wishlists')
    op.drop_index('idx_wishlist_user_listing', table_name='wishlists')
    op.drop_table('wishlists')
    op.drop_index(op.f('ix_seasonal_overrides_starts_at'), table_name='seasonal_overrides')
    op.drop_index(op.f('ix_seasonal_overrides_listing_id'), table_name='seasonal_overrides')
    op.drop_index(op.f('ix_seasonal_overrides_id'), table_name='seasonal_overrides')
    op.drop_index(op.f('ix_seasonal_overrides_ends_at'), table_name='seasonal_overrides')
    op.drop_index('idx_seasonal_override_dates', table_name='seasonal_overrides')
    op.drop_table('seasonal_overrides')
    op.drop_index(op.f('ix_search_snapshots_listing_id'), table_name='search_snapshots')
    op.drop_index(op.f('ix_search_snapshots_indexed_at'), table_name='search_snapshots')
    op.drop_index(op.f('ix_search_snapshots_id'), table_name='search_snapshots')
    op.drop_index('idx_search_snapshot_indexed', table_name='search_snapshots')
    op.drop_table('search_snapshots')
    op.drop_index(op.f('ix_reviews_listing_id'), table_name='reviews')
    op.drop_index(op.f('ix_reviews_id'), table_name='reviews')
    op.drop_index(op.f('ix_reviews_host_id'), table_name='reviews')
    op.drop_index(op.f('ix_reviews_guest_id'), table_name='reviews')
    op.drop_index(op.f('ix_reviews_booking_id'), table_name='reviews')
    op.drop_index('idx_review_moderation', table_name='reviews')
    op.drop_index('idx_review_listing_rating', table_name='reviews')
    op.drop_index('idx_review_listing_guest', table_name='reviews')
    op.drop_table('reviews')
    op.drop_index(op.f('ix_promotions_start_date'), table_name='promotions')
    op.drop_index(op.f('ix_promotions_promotion_type'), table_name='promotions')
    op.drop_index(op.f('ix_promotions_listing_id'), table_name='promotions')
    op.drop_index(op.f('ix_promotions_is_active'), table_name='promotions')
    op.drop_index(op.f('ix_promotions_id'), table_name='promotions')
    op.drop_index(op.f('ix_promotions_end_date'), table_name='promotions')
    op.drop_index(op.f('ix_promotions_agency_id'), table_name='promotions')
    op.drop_index('idx_promotion_type_dates', table_name='promotions')
    op.drop_index('idx_promotion_listing', table_name='promotions')
    op.drop_table('promotions')
    op.drop_index(op.f('ix_pricing_rules_listing_id'), table_name='pricing_rules')
    op.drop_index(op.f('ix_pricing_rules_id'), table_name='pricing_rules')
    op.drop_index('idx_pricing_listing_dates', table_name='pricing_rules')
    op.drop_index('idx_pricing_listing_active', table_name='pricing_rules')
    op.drop_table('pricing_rules')
    op.drop_index(op.f('ix_pricing_models_listing_id'), table_name='pricing_models')
    op.drop_index(op.f('ix_pricing_models_id'), table_name='pricing_models')
    op.drop_table('pricing_models')
    op.drop_index(op.f('ix_price_calendars_listing_id'), table_name='price_calendars')
    op.drop_index(op.f('ix_price_calendars_id'), table_name='price_calendars')
    op.drop_index(op.f('ix_price_calendars_date'), table_name='price_calendars')
    op.drop_index('idx_price_calendar_listing_date', table_name='price_calendars')
    op.drop_table('price_calendars')
    op.drop_index(op.f('ix_listing_rules_listing_id'), table_name='listing_rules')
    op.drop_index(op.f('ix_listing_rules_id'), table_name='listing_rules')
    op.drop_table('listing_rules')
    op.drop_index(op.f('ix_listing_photos_listing_id'), table_name='listing_photos')
    op.drop_index(op.f('ix_listing_photos_id'), table_name='listing_photos')
    op.drop_index('idx_photo_listing_order', table_name='listing_photos')
    op.drop_table('listing_photos')
    op.drop_index(op.f('ix_listing_locations_listing_id'), table_name='listing_locations')
    op.drop_index(op.f('ix_listing_locations_id'), table_name='listing_locations')
    op.drop_index('idx_listing_locations_coordinates', table_name='listing_locations', postgresql_using='gist')
    op.drop_index('idx_listing_location_coords', table_name='listing_locations', postgresql_using='gist')
    op.drop_table('listing_locations')
    op.drop_index(op.f('ix_listing_images_listing_id'), table_name='listing_images')
    op.drop_index(op.f('ix_listing_images_id'), table_name='listing_images')
    op.drop_index('idx_image_listing_position', table_name='listing_images')
    op.drop_table('listing_images')
    op.drop_index(op.f('ix_listing_drafts_listing_id'), table_name='listing_drafts')
    op.drop_index(op.f('ix_listing_drafts_id'), table_name='listing_drafts')
    op.drop_index(op.f('ix_listing_drafts_host_profile_id'), table_name='listing_drafts')
    op.drop_table('listing_drafts')
    op.drop_index(op.f('ix_listing_availability_listing_id'), table_name='listing_availability')
    op.drop_index(op.f('ix_listing_availability_id'), table_name='listing_availability')
    op.drop_index(op.f('ix_listing_availability_date'), table_name='listing_availability')
    op.drop_index('idx_availability_listing_date', table_name='listing_availability')
    op.drop_index('idx_availability_date_available', table_name='listing_availability')
    op.drop_table('listing_availability')
    op.drop_index(op.f('ix_listing_amenities_listing_id'), table_name='listing_amenities')
    op.drop_index(op.f('ix_listing_amenities_id'), table_name='listing_amenities')
    op.drop_index(op.f('ix_listing_amenities_amenity_id'), table_name='listing_amenities')
    op.drop_index('idx_listing_amenity_unique', table_name='listing_amenities')
    op.drop_table('listing_amenities')
    op.drop_index(op.f('ix_counter_offers_status'), table_name='counter_offers')
    op.drop_index(op.f('ix_counter_offers_listing_id'), table_name='counter_offers')
    op.drop_index(op.f('ix_counter_offers_id'), table_name='counter_offers')
    op.drop_index(op.f('ix_counter_offers_guest_id'), table_name='counter_offers')
    op.drop_index(op.f('ix_counter_offers_expires_at'), table_name='counter_offers')
    op.drop_index('idx_counter_offer_listing_guest', table_name='counter_offers')
    op.drop_index('idx_counter_offer_expires', table_name='counter_offers')
    op.drop_table('counter_offers')
    op.drop_index(op.f('ix_conversations_listing_id'), table_name='conversations')
    op.drop_index(op.f('ix_conversations_id'), table_name='conversations')
    op.drop_index(op.f('ix_conversations_booking_id'), table_name='conversations')
    op.drop_index('idx_conversation_listing', table_name='conversations')
    op.drop_index('idx_conversation_booking', table_name='conversations')
    op.drop_table('conversations')
    op.drop_index(op.f('ix_calendars_listing_id'), table_name='calendars')
    op.drop_index(op.f('ix_calendars_id'), table_name='calendars')
    op.drop_table('calendars')
    op.drop_index(op.f('ix_blocked_dates_listing_id'), table_name='blocked_dates')
    op.drop_index(op.f('ix_blocked_dates_id'), table_name='blocked_dates')
    op.drop_index(op.f('ix_blocked_dates_date'), table_name='blocked_dates')
    op.drop_index('idx_blocked_date_listing_date', table_name='blocked_dates')
    op.drop_table('blocked_dates')
    op.drop_index(op.f('ix_travel_plan_bookings_travel_plan_id'), table_name='travel_plan_bookings')
    op.drop_index(op.f('ix_travel_plan_bookings_id'), table_name='travel_plan_bookings')
    op.drop_index(op.f('ix_travel_plan_bookings_booking_id'), table_name='travel_plan_bookings')
    op.drop_index('idx_travel_plan_booking', table_name='travel_plan_bookings')
    op.drop_table('travel_plan_bookings')
    op.drop_index(op.f('ix_tax_documents_status'), table_name='tax_documents')
    op.drop_index(op.f('ix_tax_documents_id'), table_name='tax_documents')
    op.drop_index(op.f('ix_tax_documents_host_id'), table_name='tax_documents')
    op.drop_index('idx_tax_doc_host_status', table_name='tax_documents')
    op.drop_table('tax_documents')
    op.drop_index(op.f('ix_payouts_status'), table_name='payouts')
    op.drop_index(op.f('ix_payouts_id'), table_name='payouts')
    op.drop_index(op.f('ix_payouts_host_profile_id'), table_name='payouts')
    op.drop_index(op.f('ix_payouts_host_id'), table_name='payouts')
    op.drop_index(op.f('ix_payouts_booking_id'), table_name='payouts')
    op.drop_index(op.f('ix_payouts_batch_id'), table_name='payouts')
    op.drop_index('idx_payout_host_status', table_name='payouts')
    op.drop_index('idx_payout_batch', table_name='payouts')
    op.drop_table('payouts')
    op.drop_index(op.f('ix_listings_title'), table_name='listings')
    op.drop_index(op.f('ix_listings_status'), table_name='listings')
    op.drop_index(op.f('ix_listings_slug'), table_name='listings')
    op.drop_index(op.f('ix_listings_rating'), table_name='listings')
    op.drop_index(op.f('ix_listings_listing_type'), table_name='listings')
    op.drop_index(op.f('ix_listings_id'), table_name='listings')
    op.drop_index(op.f('ix_listings_host_profile_id'), table_name='listings')
    op.drop_index(op.f('ix_listings_host_id'), table_name='listings')
    op.drop_index(op.f('ix_listings_country'), table_name='listings')
    op.drop_index(op.f('ix_listings_city'), table_name='listings')
    op.drop_index(op.f('ix_listings_agency_id'), table_name='listings')
    op.drop_index('idx_listing_type_status', table_name='listings')
    op.drop_index('idx_listing_rating', table_name='listings')
    op.drop_index('idx_listing_location', table_name='listings')
    op.drop_index('idx_listing_host_status', table_name='listings')
    op.drop_index('idx_listing_host_profile_status', table_name='listings')
    op.drop_index('idx_listing_city_country', table_name='listings')
    op.drop_table('listings')
    op.drop_index(op.f('ix_co_hosts_status'), table_name='co_hosts')
    op.drop_index(op.f('ix_co_hosts_id'), table_name='co_hosts')
    op.drop_index(op.f('ix_co_hosts_host_id'), table_name='co_hosts')
    op.drop_index(op.f('ix_co_hosts_email'), table_name='co_hosts')
    op.drop_index('idx_cohost_host_status', table_name='co_hosts')
    op.drop_table('co_hosts')
    op.drop_index(op.f('ix_user_verifications_user_id'), table_name='user_verifications')
    op.drop_index(op.f('ix_user_verifications_id'), table_name='user_verifications')
    op.drop_index('idx_verification_user_type', table_name='user_verifications')
    op.drop_table('user_verifications')
    op.drop_index(op.f('ix_user_passkeys_user_id'), table_name='user_passkeys')
    op.drop_index(op.f('ix_user_passkeys_id'), table_name='user_passkeys')
    op.drop_index(op.f('ix_user_passkeys_credential_id'), table_name='user_passkeys')
    op.drop_index('idx_passkey_user_credential', table_name='user_passkeys')
    op.drop_table('user_passkeys')
    op.drop_index(op.f('ix_user_devices_user_id'), table_name='user_devices')
    op.drop_index(op.f('ix_user_devices_id'), table_name='user_devices')
    op.drop_index(op.f('ix_user_devices_fingerprint'), table_name='user_devices')
    op.drop_index('idx_device_user_fingerprint', table_name='user_devices')
    op.drop_table('user_devices')
    op.drop_index(op.f('ix_two_factor_challenges_user_id'), table_name='two_factor_challenges')
    op.drop_index(op.f('ix_two_factor_challenges_id'), table_name='two_factor_challenges')
    op.drop_index('idx_2fa_user_expires', table_name='two_factor_challenges')
    op.drop_table('two_factor_challenges')
    op.drop_index(op.f('ix_travel_plans_user_id'), table_name='travel_plans')
    op.drop_index(op.f('ix_travel_plans_is_saved'), table_name='travel_plans')
    op.drop_index(op.f('ix_travel_plans_is_booked'), table_name='travel_plans')
    op.drop_index(op.f('ix_travel_plans_id'), table_name='travel_plans')
    op.drop_index('idx_travel_plan_user_saved', table_name='travel_plans')
    op.drop_index('idx_travel_plan_dates', table_name='travel_plans')
    op.drop_table('travel_plans')
    op.drop_index(op.f('ix_payment_methods_user_id'), table_name='payment_methods')
    op.drop_index(op.f('ix_payment_methods_id'), table_name='payment_methods')
    op.drop_index('idx_payment_method_user_default', table_name='payment_methods')
    op.drop_table('payment_methods')
    op.drop_index(op.f('ix_notifications_user_id'), table_name='notifications')
    op.drop_index(op.f('ix_notifications_notification_type'), table_name='notifications')
    op.drop_index(op.f('ix_notifications_is_read'), table_name='notifications')
    op.drop_index(op.f('ix_notifications_id'), table_name='notifications')
    op.drop_index('idx_notification_user_read', table_name='notifications')
    op.drop_index('idx_notification_type', table_name='notifications')
    op.drop_table('notifications')
    op.drop_index(op.f('ix_loyalty_ledgers_user_id'), table_name='loyalty_ledgers')
    op.drop_index(op.f('ix_loyalty_ledgers_program_id'), table_name='loyalty_ledgers')
    op.drop_index(op.f('ix_loyalty_ledgers_id'), table_name='loyalty_ledgers')
    op.drop_index('idx_loyalty_ledger_user_program', table_name='loyalty_ledgers')
    op.drop_table('loyalty_ledgers')
    op.drop_index(op.f('ix_host_profiles_user_id'), table_name='host_profiles')
    op.drop_index(op.f('ix_host_profiles_status'), table_name='host_profiles')
    op.drop_index(op.f('ix_host_profiles_id'), table_name='host_profiles')
    op.drop_index('idx_host_profile_status', table_name='host_profiles')
    op.drop_table('host_profiles')
    op.drop_index(op.f('ix_files_uploaded_by'), table_name='files')
    op.drop_index(op.f('ix_files_id'), table_name='files')
    op.drop_index(op.f('ix_files_file_type'), table_name='files')
    op.drop_index(op.f('ix_files_file_category'), table_name='files')
    op.drop_table('files')
    op.drop_index(op.f('ix_dispute_evidences_id'), table_name='dispute_evidences')
    op.drop_index(op.f('ix_dispute_evidences_dispute_id'), table_name='dispute_evidences')
    op.drop_index('idx_dispute_evidence_type', table_name='dispute_evidences')
    op.drop_table('dispute_evidences')
    op.drop_index(op.f('ix_audit_logs_resource_id'), table_name='audit_logs')
    op.drop_index(op.f('ix_audit_logs_resource'), table_name='audit_logs')
    op.drop_index(op.f('ix_audit_logs_id'), table_name='audit_logs')
    op.drop_index(op.f('ix_audit_logs_actor_id'), table_name='audit_logs')
    op.drop_index(op.f('ix_audit_logs_action'), table_name='audit_logs')
    op.drop_index('idx_audit_resource', table_name='audit_logs')
    op.drop_index('idx_audit_actor_action', table_name='audit_logs')
    op.drop_table('audit_logs')
    op.drop_index(op.f('ix_analytics_events_user_id'), table_name='analytics_events')
    op.drop_index(op.f('ix_analytics_events_source'), table_name='analytics_events')
    op.drop_index(op.f('ix_analytics_events_recorded_at'), table_name='analytics_events')
    op.drop_index(op.f('ix_analytics_events_id'), table_name='analytics_events')
    op.drop_index(op.f('ix_analytics_events_event_name'), table_name='analytics_events')
    op.drop_index('idx_analytics_user_recorded', table_name='analytics_events')
    op.drop_index('idx_analytics_event_name_source', table_name='analytics_events')
    op.drop_table('analytics_events')
    op.drop_index(op.f('ix_accounts_user_id'), table_name='accounts')
    op.drop_index(op.f('ix_accounts_provider_id'), table_name='accounts')
    op.drop_index(op.f('ix_accounts_provider'), table_name='accounts')
    op.drop_index(op.f('ix_accounts_id'), table_name='accounts')
    op.drop_index('idx_account_user_provider', table_name='accounts')
    op.drop_index('idx_account_provider_unique', table_name='accounts')
    op.drop_table('accounts')
    op.drop_index(op.f('ix_users_username'), table_name='users')
    op.drop_index(op.f('ix_users_status'), table_name='users')
    op.drop_index(op.f('ix_users_role'), table_name='users')
    op.drop_index(op.f('ix_users_phone_number'), table_name='users')
    op.drop_index(op.f('ix_users_is_active'), table_name='users')
    op.drop_index(op.f('ix_users_id'), table_name='users')
    op.drop_index(op.f('ix_users_email'), table_name='users')
    op.drop_index(op.f('ix_users_agency_id'), table_name='users')
    op.drop_index('idx_user_role_status', table_name='users')
    op.drop_index('idx_user_email_active', table_name='users')
    op.drop_index('idx_user_agency', table_name='users')
    op.drop_table('users')
    op.drop_index(op.f('ix_disputes_status'), table_name='disputes')
    op.drop_index(op.f('ix_disputes_id'), table_name='disputes')
    op.drop_index(op.f('ix_disputes_booking_id'), table_name='disputes')
    op.drop_index('idx_dispute_booking_status', table_name='disputes')
    op.drop_table('disputes')
    op.drop_index(op.f('ix_booking_timeline_events_id'), table_name='booking_timeline_events')
    op.drop_index(op.f('ix_booking_timeline_events_booking_id'), table_name='booking_timeline_events')
    op.drop_index('idx_timeline_booking_status', table_name='booking_timeline_events')
    op.drop_table('booking_timeline_events')
    op.drop_index(op.f('ix_webhook_events_status'), table_name='webhook_events')
    op.drop_index(op.f('ix_webhook_events_source'), table_name='webhook_events')
    op.drop_index(op.f('ix_webhook_events_id'), table_name='webhook_events')
    op.drop_index(op.f('ix_webhook_events_event_type'), table_name='webhook_events')
    op.drop_index(op.f('ix_webhook_events_event_id'), table_name='webhook_events')
    op.drop_index('idx_webhook_source_event_id', table_name='webhook_events')
    op.drop_index('idx_webhook_event_type_status', table_name='webhook_events')
    op.drop_table('webhook_events')
    op.drop_index(op.f('ix_payout_batches_status'), table_name='payout_batches')
    op.drop_index(op.f('ix_payout_batches_scheduled_at'), table_name='payout_batches')
    op.drop_index(op.f('ix_payout_batches_id'), table_name='payout_batches')
    op.drop_index('idx_payout_batch_status_scheduled', table_name='payout_batches')
    op.drop_table('payout_batches')
    op.drop_index(op.f('ix_payments_transaction_id'), table_name='payments')
    op.drop_index(op.f('ix_payments_stripe_payment_intent_id'), table_name='payments')
    op.drop_index(op.f('ix_payments_status'), table_name='payments')
    op.drop_index(op.f('ix_payments_processor_ref'), table_name='payments')
    op.drop_index(op.f('ix_payments_paypal_order_id'), table_name='payments')
    op.drop_index(op.f('ix_payments_method_id'), table_name='payments')
    op.drop_index(op.f('ix_payments_id'), table_name='payments')
    op.drop_index(op.f('ix_payments_booking_id'), table_name='payments')
    op.drop_index('idx_payment_processor_ref', table_name='payments')
    op.drop_index('idx_payment_booking_status', table_name='payments')
    op.drop_table('payments')
    op.drop_index(op.f('ix_loyalty_programs_id'), table_name='loyalty_programs')
    op.drop_index(op.f('ix_loyalty_programs_code'), table_name='loyalty_programs')
    op.drop_index('idx_loyalty_program_code', table_name='loyalty_programs')
    op.drop_table('loyalty_programs')
    op.drop_index(op.f('ix_coupons_start_date'), table_name='coupons')
    op.drop_index(op.f('ix_coupons_is_active'), table_name='coupons')
    op.drop_index(op.f('ix_coupons_id'), table_name='coupons')
    op.drop_index(op.f('ix_coupons_end_date'), table_name='coupons')
    op.drop_index(op.f('ix_coupons_code'), table_name='coupons')
    op.drop_index('idx_coupon_dates', table_name='coupons')
    op.drop_index('idx_coupon_code_active', table_name='coupons')
    op.drop_table('coupons')
    op.drop_index(op.f('ix_bookings_status'), table_name='bookings')
    op.drop_index(op.f('ix_bookings_payment_status'), table_name='bookings')
    op.drop_index(op.f('ix_bookings_payment_intent_id'), table_name='bookings')
    op.drop_index(op.f('ix_bookings_payment_id'), table_name='bookings')
    op.drop_index(op.f('ix_bookings_listing_id'), table_name='bookings')
    op.drop_index(op.f('ix_bookings_id'), table_name='bookings')
    op.drop_index(op.f('ix_bookings_guest_id'), table_name='bookings')
    op.drop_index(op.f('ix_bookings_coupon_code'), table_name='bookings')
    op.drop_index(op.f('ix_bookings_check_out_date'), table_name='bookings')
    op.drop_index(op.f('ix_bookings_check_out'), table_name='bookings')
    op.drop_index(op.f('ix_bookings_check_in_date'), table_name='bookings')
    op.drop_index(op.f('ix_bookings_check_in'), table_name='bookings')
    op.drop_index(op.f('ix_bookings_booking_number'), table_name='bookings')
    op.drop_index('idx_booking_payment_status', table_name='bookings')
    op.drop_index('idx_booking_listing_dates', table_name='bookings')
    op.drop_index('idx_booking_guest_status', table_name='bookings')
    op.drop_index('idx_booking_dates', table_name='bookings')
    op.drop_table('bookings')
    op.drop_index(op.f('ix_amenities_key'), table_name='amenities')
    op.drop_index(op.f('ix_amenities_id'), table_name='amenities')
    op.drop_index(op.f('ix_amenities_category'), table_name='amenities')
    op.drop_table('amenities')
    op.drop_index(op.f('ix_agencies_slug'), table_name='agencies')
    op.drop_index(op.f('ix_agencies_name'), table_name='agencies')
    op.drop_index(op.f('ix_agencies_is_active'), table_name='agencies')
    op.drop_index(op.f('ix_agencies_id'), table_name='agencies')
    op.drop_index(op.f('ix_agencies_email'), table_name='agencies')
    op.drop_table('agencies')
    # ### end Alembic commands ###

